{% extends "base.html" %}
{% block content %}
    <!-- query 1 -->
    <div>
      <h3>List of all senators who have been absent at least once</h3>
      <h5>
        SELECT
            name                                                                                  
        FROM
            idb_vote v 
        LEFT JOIN
            idb_senator s
            ON v.senator_id = s.id
        WHERE
            v.vote = 'ABS'</h5>      
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Name</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Leticia Van de Putte</td>
                    </tr>
                    <tr>
                        <td>John Carona</td>
                    </tr>
                </tbody>
            </table>
        </div>        
      <br>
    </div>

    <!-- query 2 -->
    <div>
      <h3>The senator who's voted nay the most</h3>
      <h5>
        SELECT
            name, T.NayCount           
        FROM
        ( 
            SELECT
                senator_id, NayCount                                              
            FROM
            (
                SELECT
                    senator_id,
                    COUNT(*) as NayCount                                                                                    
                FROM
                    idb_vote                                                                                        
                LEFT JOIN
                    idb_senator                                                                                                                                                                           
                        ON idb_vote.senator_id = idb_senator.id                                                                           
                WHERE
                    idb_vote.vote = 'NAY'
                GROUP BY
                    idb_vote.senator_id
            ) AS R
            WHERE 
                R.NayCount >= 
                (
                    SELECT
                        MAX(S.NayCount)
                        FROM
                        (
                            SELECT
                                COUNT(*) AS NayCount
                            FROM
                                idb_vote v
                            LEFT JOIN
                                idb_senator s
                                    ON v.senator_id = s.id
                            WHERE
                                v.vote = 'NAY'
                            GROUP BY
                                v.senator_id
                        ) AS S
                )     
        ) AS T
        INNER JOIN idb_senator
            ON T.senator_id = idb_senator.id
        ORDER BY T.senator_id
        </h5>      
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>NayCount</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Donna Campbell</td>
                        <td>1</td>
                    </tr>
                    <tr>
                        <td>Robert Duncan</td>
                        <td>1</td>
                    </tr>
                    <tr>
                        <td>Tony Fraser</td>
                        <td>1</td>
                    </tr>
                    <tr>
                        <td>Dan Patrick</td>
                        <td>1</td>
                    </tr>
                    <tr>
                        <td>Jose Rodriguez</td>
                        <td>1</td>
                    </tr>
                    <tr>
                        <td>Charles Schwertner</td>
                        <td>1</td>
                    </tr>  
                </tbody>
            </table>
        </div>     
      <br>
    </div>
{% endblock %}
